<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>example</title>
    <meta name="renderer" content="webkit" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="format-detection" content="telephone=no"/>
</head>
<style>
    body {
        margin: 0;
        padding: 0;
    }
    canvas {
        background: #111;
    }
</style>
<body>
  <canvas id="c"></canvas>
</body>
<script>
  (function(){
    let c = document.getElementById("c");
    let ctx = c.getContext("2d");
    c.width = innerWidth;
    c.height = innerHeight;
    let lines = [];
    let maxSpeed = 3;    // 雨的速度
    let spacing = .2;     // 雨的数量
    let xSpacing = 0;
    let n = innerWidth / spacing;
    let colors = ["#fff", "#f1f1f1", "#f2f2f2", "#999"];
    for (let i = 0; i < n; i++){
      xSpacing += spacing;
      lines.push({
        x: xSpacing,
        y: Math.round(Math.random()*c.height),
        width: .3,
        height: Math.round(innerHeight/(80+Math.random())),
        speed: (1 + Math.random())*maxSpeed,
        color: colors[Math.floor(Math.random() * colors.length)]
      });
    }

    function draw(){
      ctx.clearRect(0,0,c.width,c.height);
      for (let i = 0; i < n; i++){
        ctx.fillStyle = lines[i].color;
        ctx.fillRect(lines[i].x, lines[i].y, lines[i].width, lines[i].height);
        lines[i].y += lines[i].speed;      //每次播放距离的变换 有规律
        if(lines[i].y > c.height){
          lines[i].y = 0 - lines[i].height;
        }
      }
      requestAnimationFrame(draw);
    }
//    requestAnimationFrame(draw);
  }());

</script>
</html>
